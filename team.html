<!DOCTYPE html>
<html lang="en">

	<head>
	
		<meta charset="UTF-8">
		
		<link rel="stylesheet" type="text/css" href="teamCSS.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
		<script src="https://d3js.org/d3.v5.js"></script>
<!--		<script src="script.js"></script>-->

		<script>

			var dataPath = "http://localhost:8888/Desktop/CS5044%20-%20Info%20Vis/P3/Part%202//Data/Premier_League_2017-2018.csv"
			var uniqueTeams=[];
			var SeasonInfo=[];
			var dataGlobal;
			var parameters = location.search.substring(1).split("=");
			var index = parameters[1];


			d3.csv(dataPath)
					.then(function (data) {
						dataGlobal=data;
						data.forEach(function(d) {
							if(uniqueTeams.indexOf(d["HomeTeam"])===-1){
								uniqueTeams.push(d["HomeTeam"]);
							}
						});
						//console.log(uniqueTeams);
						getLeagueInfo();
						changeColorAndImage();
						setUpSecondVis();
						setUpThirdVis();
					});

			function setUpSecondVis() {
			
				var data = [
				{name: "Wins", count: SeasonInfo[index]["wins"], color: "#00b300"},
				{name: "Draws", count: SeasonInfo[index]["draws"], color: "#0000cc"},
				{name: "Losses", count: SeasonInfo[index]["losses"], color: "#e60000"},];
				
				var width = 540, height = 540, radius = 200;
				
				var arc = d3.arc()
					.outerRadius(radius - 10)
					.innerRadius(100);
					
				var pie = d3.pie()
					.sort(null)
					.value(function(d) {
						return d.count;
					});
					
				var svg = d3.select("#secondVis").append("svg")
					.attr("width", width)
					.attr("height", height)
					.append("g")
					.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
				
				var g = svg.selectAll(".arc")
					.data(pie(data))
					.enter().append("g");
				
				g.append("path")
					.attr("d", arc)
					.style("fill", function(d,i) {
						return d.data.color;
					});
					
				g.append("text")
					.attr("transform", function(d) {
						var _d = arc.centroid(d);
						_d[0] *= 1.6;	//multiply by a constant factor
						_d[1] *= 1.6;	//multiply by a constant factor
						return "translate(" + _d + ")";
					})
					.attr("dy", ".50em")
					.style("text-anchor", "middle")
					.text(function(d) {
						return d.data.name + ": " +d.data.count;
					});	
					
				g.append("svg:image")
					.attr("xlink:href", "Teams/"+index+".png")
					.attr("x", "-50")
					.attr("y", "-50")
					.attr("width", "100")
					.attr("height", "100");
			};
			
			
			function setUpThirdVis() {
			
				var parameters = location.search.substring(1).split("=");

				var index = parameters[1];
				
				var data = [
				{name: "Home Goals", count: SeasonInfo[index]["home_goals"], color: "#00b300"},
				{name: "Away Goals", count: SeasonInfo[index]["away_goals"], color: "#0000cc"},];
				
				var width = 540, height = 540, radius = 200;
				
				var arc = d3.arc()
					.outerRadius(radius - 10)
					.innerRadius(100);
					
				var pie = d3.pie()
					.sort(null)
					.value(function(d) {
						return d.count;
					});
					
				var svg = d3.select("#thirdVis").append("svg")
					.attr("width", width)
					.attr("height", height)
					.append("g")
					.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
				
				var g = svg.selectAll(".arc")
					.data(pie(data))
					.enter().append("g");
				
				g.append("path")
					.attr("d", arc)
					.style("fill", function(d,i) {
						return d.data.color;
					});
					
				g.append("text")
					.attr("transform", function(d) {
						var _d = arc.centroid(d);
						_d[0] *= 1.7;	//multiply by a constant factor
						_d[1] *= 1.7;	//multiply by a constant factor
						return "translate(" + _d + ")";
					})
					.attr("dy", ".50em")
					.style("text-anchor", "middle")
					.text(function(d) {
						return d.data.name + ": " +d.data.count;
					});	
					
				g.append("svg:image")
					.attr("xlink:href", "Teams/"+index+".png")
					.attr("x", "-50")
					.attr("y", "-50")
					.attr("width", "100")
					.attr("height", "100");
			};			

			function changeColorAndImage() {
				var colors = ["#66e0ff", "#e60000", "#002db3", "#e60000", "#002db3", "#e60000", "#002db3", "#002db3", "#66e0ff", "#000000", "#002db3", "#e60000", "#cc0000", "#000000", "#4d79ff", "#4d79ff", "#e60000", "#000000", "#e60000", "#002db3"];
				var image = document.getElementById("teamLogo");
				image.src = "Teams/"+index+".png";
				if(index == 2){
					image.style.height = "130px";
					image.style.width = "80px";
					image.style.marginLeft = "875px";					
				}
				else if(index == 15){
					image.style.height = "150px";
					image.style.width = "120px";
					image.style.marginLeft = "855px";					
				}				
				else {
					image.style.height = "130px";
					image.style.width = "130px";
				}
			}
			//Gets data about each team's performance for the whole season
			function getLeagueInfo(){
				var teamWins=[];
				var teamDraws=[];
				var teamLosses=[];
				var homeGoals=[];
				var awayGoals=[];
				var concededGoals=[];
				var yellowCards=[];
				var redCards=[];
				var corners=[];
				for (var i = 0; i < uniqueTeams.length; i++) {
					var wins =0;
					var draws =0;
					var losses =0;
					var hg =0;
					var ag =0;
					var cg =0;
					var yc =0;
					var rc =0;
					var crn =0;

					dataGlobal.forEach(function(d) {
						if((uniqueTeams[i]===d["HomeTeam"])&&(d["FTR"]==="H")){
							wins++;
						}
						if((uniqueTeams[i]===d["AwayTeam"])&&(d["FTR"]==="A")){
							wins++;
						}
						if((uniqueTeams[i]===d["HomeTeam"])&&(d["FTR"]==="D")){
							draws++;
						}
						if((uniqueTeams[i]===d["AwayTeam"])&&(d["FTR"]==="D")){
							draws++;
						}
						if((uniqueTeams[i]===d["HomeTeam"])&&(d["FTR"]==="A")){
							losses++;
						}
						if((uniqueTeams[i]===d["AwayTeam"])&&(d["FTR"]==="H")){
							losses++;
						}
						if(uniqueTeams[i]===d["HomeTeam"]){
							hg=hg+parseInt(d["FTHG"]);
						}
						if(uniqueTeams[i]===d["AwayTeam"]){
							ag=ag+parseInt(d["FTAG"]);
						}
						if(uniqueTeams[i]===d["AwayTeam"]){
							cg=cg+parseInt(d["FTHG"]);
						}
						if(uniqueTeams[i]===d["HomeTeam"]){
							cg=cg+parseInt(d["FTAG"]);
						}
						if(uniqueTeams[i]===d["AwayTeam"]){
							yc=yc+parseInt(d["AY"]);
						}
						if(uniqueTeams[i]===d["HomeTeam"]){
							yc=yc+parseInt(d["HY"]);
						}
						if(uniqueTeams[i]===d["AwayTeam"]){
							rc=rc+parseInt(d["AR"]);
						}
						if(uniqueTeams[i]===d["HomeTeam"]){
							rc=rc+parseInt(d["HR"]);
						}
						if(uniqueTeams[i]===d["AwayTeam"]){
							crn=crn+parseInt(d["AR"]);
						}
						if(uniqueTeams[i]===d["HomeTeam"]){
							crn=crn+parseInt(d["HR"]);
						}
					});
					teamWins.push(wins);
					teamDraws.push(draws);
					teamLosses.push(losses);
					homeGoals.push(hg);
					awayGoals.push(ag);
					concededGoals.push(cg);
					yellowCards.push(yc);
					redCards.push(rc);
					corners.push(crn);
				}


				//Sort Data to match Premier League Rankings and merge them into one array
				for (var j = 0; j < uniqueTeams.length; j++)
					SeasonInfo.push({'name': uniqueTeams[j], 'wins': teamWins[j], 'draws': teamDraws[j], 'losses': teamLosses[j],
						'total_goals':homeGoals[j]+awayGoals[j],'home_goals':homeGoals[j],'away_goals':awayGoals[j],
						'conceded_goals':concededGoals[j], 'goal_difference': homeGoals[j]+awayGoals[j]-concededGoals[j] ,
						'yellow_cards': yellowCards[j],'rec_cards':redCards[j], 'booking_pts':yellowCards[j]*10+redCards[j]*25,
						'corners':corners[j],'points' :teamWins[j]*3+teamDraws[j]});

				SeasonInfo.sort(function(a, b) {
					if(a.points!==b.points) {
						return ((a.points > b.points) ? -1 : ((a.points === b.points) ? 0 : 1));
					}
					else{
						return ((a.goal_difference > b.goal_difference) ? -1 : ((a.goal_difference === b.goal_difference) ? 0 : 1));
					}
				});
				console.log(SeasonInfo);
			}
			
			<!-- function getWinLossData(teamID) { -->
				<!-- var data = [ -->
				<!-- {name: "wins", count: 2, color: "#00ff00"}, -->
				<!-- {name: "draws", count: 2, color: "#0000ff"}, -->
				<!-- {name: "losses", count: 1, color: "#ff0000"},]; -->
				<!-- return data; -->
			<!-- } -->

			<!-- function loadTeam(teamID) { -->
				<!-- var teamLogo = document.getElementsByClassName("teamLogo"); -->
				<!-- var info = document.getElementsByClassName("teamInfo"); -->
				
				<!-- for(var i = 0; i < teamLogo.length; i++) { -->
					<!-- $(teamLogo[i].css("background-image", "url(Teams/"+teamID+".png)"; -->
				<!-- } -->
				
				<!-- info[0].innerHTML = SeasonInfo[teamID][name]; -->
				<!-- info[1].innerHTML = "Position: "+teamID; -->
				<!-- info[2].innerHTML = "Points: "+SeasonInfo[teamID][points];				 -->
			<!-- } -->
			

		</script>
	</head>

	<body>
	
		<div id="nav_bar">
			<div class="circleBack"></div>
			<img id="teamLogo" src="Other/Premier_League_Logo.png">
		</div>	
		
		<div id="secondVis">
		<h1>TEST 2</h1>
		</div>
		
		<div id="thirdVis">
		<h1>TEST 3</h1>
		</div>
		
		<div id="fourthVis">
		<h1>TEST 3</h1>
		</div>
		
		
		
		<div id="footer">
			<a onclick="alert('This has not been implemented')" class="fa fa-facebook"></a>
			<a onclick="alert('This has not been implemented')" class="fa fa-twitter"></a>
			<a onclick="alert('This has not been implemented')" class="fa fa-google"></a>
			<a onclick="alert('This has not been implemented')" class="fa fa-linkedin"></a>
			<a onclick="alert('This has not been implemented')" class="fa fa-youtube"></a>
			<a onclick="alert('This has not been implemented')" class="fa fa-snapchat-ghost"></a>
			<h4>DISCLAIMER</h4>
			<p id="disclaimer">This site has been constructed as coursework for module CS5044 Information Visualiztaion, at the University of St. Andrews.  It is not a working website and is not connected with any site or individual referenced.</p>
		</div>
	
<!--		<script>
				var data = [
				{name: "wins", count: 2, color: "#00ff00"},
				{name: "draws", count: 2, color: "#0000ff"},
				{name: "losses", count: 1, color: "#ff0000"},];
				
				
				var width = 540, height = 540, radius = 200;
				
				var arc = d3.arc()
					.outerRadius(radius - 10)
					.innerRadius(100);
					
				var pie = d3.pie()
					.sort(null)
					.value(function(d) {
						return d.count;
					});
					
				var svg = d3.select("#secondVis").append("svg")
					.attr("width", width)
					.attr("height", height)
					.append("g")
					.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
				
				var g = svg.selectAll(".arc")
					.data(pie(data))
					.enter().append("g");
				
				g.append("path")
					.attr("d", arc)
					.style("fill", function(d,i) {
						return d.data.color;
					});
					
				g.append("text")
					.attr("text-anchor", "middle")
					.attr("font-size", "4em")
					.attr("y", 20)
					.text(totalCount);
		</script>-->
	
	</body>

</html>